<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org"></script>
    <style>
        :root { --accent: #ff9500; --gold: #ffd700; --glass: rgba(255, 255, 255, 0.07); --glass-border: rgba(255, 255, 255, 0.12); }
        * { -webkit-touch-callout: none; user-select: none; box-sizing: border-box; outline: none; }
        body { 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e); color: white;
            font-family: -apple-system, sans-serif; display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 15px; min-height: 100vh; overflow-x: hidden;
        }

        .glass-card { width: 100%; max-width: 360px; background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 25px; padding: 15px; margin-bottom: 12px; }
        
        /* –ë–ª–æ–∫ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–π */
        .achievements-grid { display: flex; gap: 10px; overflow-x: auto; padding: 5px 0; scrollbar-width: none; }
        .ach-item { min-width: 70px; height: 70px; background: rgba(0,0,0,0.3); border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 25px; border: 1px solid transparent; grayscale: 1; opacity: 0.4; transition: 0.5s; }
        .ach-unlocked { grayscale: 0; opacity: 1; border-color: var(--gold); box-shadow: 0 0 10px rgba(255,215,0,0.3); }

        .btn-main { background: linear-gradient(135deg, #ff9500, #ff5e00); color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 700; width: 100%; cursor: pointer; }
        input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); color: white; padding: 12px; border-radius: 12px; margin-bottom: 10px; }

        #toast { position: fixed; bottom: 80px; background: var(--gold); color: black; padding: 10px 20px; border-radius: 20px; font-weight: bold; transform: translateY(200px); transition: 0.5s; z-index: 1000; }
        
        .mood-chart { width: 100%; height: 40px; display: flex; align-items: flex-end; gap: 4px; }
        .mood-bar { flex: 1; background: var(--accent); border-radius: 3px; min-height: 2px; }
    </style>
</head>
<body>

    <div id="toast">üèÜ –î–û–°–¢–ò–ñ–ï–ù–ò–ï –ü–û–õ–£–ß–ï–ù–û!</div>

    <div id="setup" class="glass-card" style="margin-top: 20vh; text-align: center;">
        <h2 style="color:var(--accent)">–ö–¢–û –¢–í–û–ô –ö–û–¢?</h2>
        <input type="text" id="cat-name" placeholder="–ò–º—è –∫–æ—Ç–∞">
        <select id="cat-age" style="width:100%; padding:10px; border-radius:10px; background:#1a1a1c; color:white; margin-bottom:10px;">
            <option value="kitten">–ö–æ—Ç—ë–Ω–æ–∫</option>
            <option value="adult" selected>–í–∑—Ä–æ—Å–ª—ã–π</option>
            <option value="senior">–ú—É–¥—Ä—ã–π</option>
        </select>
        <button class="btn-main" onclick="saveProfile()">–ù–ê–ß–ê–¢–¨ üêæ</button>
    </div>

    <div id="app" style="display:none; width:100%; max-width:360px;">
        <!-- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è -->
        <div class="glass-card">
            <div style="font-size: 10px; opacity: 0.6; margin-bottom: 8px;">–í–ê–®–ò –ú–ï–î–ê–õ–ò</div>
            <div class="achievements-grid">
                <div class="ach-item" id="ach-first" title="–ü–µ—Ä–≤—ã–π —Å–∫–∞–Ω">üéØ</div>
                <div class="ach-item" id="ach-ref" title="–ü—Ä–∏–≥–ª–∞—Å–∏–ª –¥—Ä—É–≥–∞">ü§ù</div>
                <div class="ach-item" id="ach-night" title="–ù–æ—á–Ω–æ–π —Ç—ã–≥–¥—ã–∫">üåô</div>
                <div class="ach-item" id="ach-pro" title="–ú–∞—Å—Ç–µ—Ä –ø–µ—Ä–µ–≤–æ–¥–∞">üó£Ô∏è</div>
            </div>
        </div>

        <div class="glass-card" style="text-align: center;">
            <div id="display-name" style="font-size: 22px; font-weight: 900; color: var(--accent);"></div>
            <div class="mood-chart" id="chart"></div>
            <div style="font-size: 12px; margin-top:5px;" id="limits-info">–õ–∏–º–∏—Ç—ã: 5 / 3</div>
        </div>

        <div class="glass-card">
            <input type="text" id="user-msg" placeholder="–°–∫–∞–∂–∏ –∫–æ—Ç—É —á—Ç–æ-–Ω–∏–±—É–¥—å...">
            <button class="btn-main" onclick="translateWithAch()">–ü–ï–†–ï–í–ï–°–¢–ò</button>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button onclick="deepScanWithAch()" style="background:none; border:none; font-size:60px; filter: drop-shadow(0 0 10px var(--accent)); cursor:pointer;">üêæ</button>
            <div id="status" style="color:var(--accent); font-weight:bold; margin-top:10px;">–ì–û–¢–û–í</div>
        </div>
        
        <button class="btn-main" style="background:#3390ec;" onclick="doInvite()">üéÅ –ü–û–ó–í–ê–¢–¨ –î–†–£–ì–ê (+5 –ë–û–ù–£–°–û–í)</button>
    </div>

<script>
    const tg = window.Telegram?.WebApp || null;
    const BOT_USERNAME = "MeowVibe_bot";
    const urlParams = new URLSearchParams(window.location.search);
    const bonusFromRef = parseInt(urlParams.get('bonus')) || 0;

    let state = {
        name: "", age: "adult",
        transLeft: 5, toolsLeft: 3,
        moodHistory: [50, 60, 45, 70, 55, 80, 50],
        achieved: [], // –°–ø–∏—Å–æ–∫ id –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –∞—á–∏–≤–æ–∫
        transCount: 0
    };

    function showToast(text) {
        const t = document.getElementById('toast');
        t.innerText = text;
        t.style.transform = "translateY(0)";
        setTimeout(() => t.style.transform = "translateY(200px)", 3000);
    }

    function unlockAchievement(id, bonus = 5) {
        if (!state.achieved.includes(id)) {
            state.achieved.push(id);
            state.transLeft += bonus;
            state.toolsLeft += bonus;
            showToast("üèÜ –û–¢–ö–†–´–¢–û: " + id + " (+5 –±–æ–Ω—É—Å–æ–≤!)");
            saveState();
            updateUI();
        }
    }

    function saveProfile() {
        state.name = document.getElementById('cat-name').value || "–ö–æ—Ç";
        state.age = document.getElementById('cat-age').value;
        saveState();
        showApp();
    }

    function showApp() {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('display-name').innerText = state.name.toUpperCase();
        if (bonusFromRef > 0) {
            unlockAchievement('–î–†–£–ì');
            // –û—á–∏—â–∞–µ–º URL
            window.history.replaceState({}, '', window.location.pathname);
        }
        updateUI();
        if(tg) { tg.ready(); tg.expand(); }
    }

    function updateUI() {
        document.getElementById('limits-info').innerText = `–ü–µ—Ä–µ–≤–æ–¥—ã: ${state.transLeft} | –•—É–∫–∏: ${state.toolsLeft}`;
        state.achieved.forEach(id => {
            const map = {'–°–ö–ê–£–¢': 'ach-first', '–î–†–£–ì': 'ach-ref', '–ü–û–õ–£–ù–û–ß–ù–ò–ö': 'ach-night', '–ü–†–û–§–ò': 'ach-pro'};
            if(map[id]) document.getElementById(map[id]).classList.add('ach-unlocked');
        });
        const chart = document.getElementById('chart');
        chart.innerHTML = "";
        state.moodHistory.forEach(v => {
            const b = document.createElement('div'); b.className = 'mood-bar'; b.style.height = v + "%"; chart.appendChild(b);
        });
    }

    function deepScanWithAch() {
        unlockAchievement('–°–ö–ê–£–¢');
        const now = new Date().getHours();
        if (now >= 0 && now < 5) unlockAchievement('–ü–û–õ–£–ù–û–ß–ù–ò–ö');
        
        document.getElementById('status').innerText = "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø...";
        if(tg) tg.HapticFeedback.impactOccurred('heavy');
        setTimeout(() => {
            state.moodHistory.shift(); state.moodHistory.push(Math.floor(Math.random()*60)+40);
            document.getElementById('status').innerText = "–û–ö ‚úÖ";
            saveState(); updateUI();
        }, 2000);
    }

    function translateWithAch() {
        if(state.transLeft <= 0) return tg?.showAlert("–õ–∏–º–∏—Ç—ã –∏—Å—á–µ—Ä–ø–∞–Ω—ã! –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞ –∏–ª–∏ –∫—É–ø–∏ Stars.");
        state.transLeft--;
        state.transCount++;
        if(state.transCount >= 10) unlockAchievement('–ü–†–û–§–ò');
        saveState(); updateUI();
        // –¢—É—Ç –∑–≤—É–∫ –º—è—É (–∏–∑ –ø—Ä–æ—à–ª—ã—Ö –∫–æ–¥–æ–≤)
    }

    function doInvite() {
        const userId = tg?.initDataUnsafe?.user?.id || "0";
        const url = `https://t.me{BOT_USERNAME}?start=ref${userId}&text=${encodeURIComponent("–£–∑–Ω–∞–π –º—ã—Å–ª–∏ —Å–≤–æ–µ–≥–æ –∫–æ—Ç–∞! üêæ")}`;
        if(tg) tg.openTelegramLink(url); else window.open(url);
    }

    function saveState() { localStorage.setItem('meow_v12_state', JSON.stringify(state)); }
    window.onload = () => {
        const saved = localStorage.getItem('meow_v12_state');
        if(saved) { state = JSON.parse(saved); showApp(); }
    };
</script>
</body>
</html>
