<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="https://telegram.org"></script>
    <style>
        :root { --accent: #ff9500; --bg: #0d0d0f; --glass: rgba(255, 255, 255, 0.05); }
        body { 
            background: var(--bg); color: white; font-family: -apple-system, sans-serif;
            display: flex; flex-direction: column; align-items: center; margin: 0; padding: 15px;
            user-select: none; overflow-x: hidden; min-height: 100vh;
        }

        /* –î–æ–≤–µ—Ä–∏–µ */
        .trust-section { width: 100%; max-width: 340px; margin-bottom: 20px; }
        .trust-label { font-size: 11px; display: flex; justify-content: space-between; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; color: var(--accent); }
        .trust-bar { width: 100%; height: 6px; background: #222; border-radius: 10px; overflow: hidden; }
        #trust-fill { width: 50%; height: 100%; background: linear-gradient(90deg, #ff4d4d, var(--accent), #4aff4a); transition: 1s; }

        /* –•—É–∫–∏ */
        .hooks-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; width: 100%; max-width: 340px; margin-bottom: 20px; }
        .hook-card { background: var(--glass); border-radius: 18px; padding: 12px; text-align: center; border: 1px solid rgba(255,255,255,0.08); cursor: pointer; position: relative; }
        .hook-card:active { transform: scale(0.95); background: rgba(255,149,0,0.1); }
        .hook-card b { font-size: 10px; display: block; margin-top: 5px; opacity: 0.7; }

        /* –ì–ª–∞–≤–Ω—ã–π –±–ª–æ–∫ */
        .main-card {
            width: 100%; max-width: 340px; background: var(--glass); border-radius: 30px;
            padding: 20px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(15px);
            text-align: center; position: relative; overflow: hidden;
        }
        #laser { position: absolute; left: 0; width: 100%; height: 2px; background: var(--accent); box-shadow: 0 0 15px var(--accent); display: none; }
        @keyframes scanAnim { 0% { top: 0%; } 100% { top: 100%; } }

        /* –í–æ–ª–Ω–∞ */
        .wave-box { display: flex; justify-content: center; gap: 3px; height: 30px; margin: 10px 0; display: none; }
        .bar { width: 3px; height: 100%; background: var(--accent); border-radius: 2px; animation: w-pulse 0.6s infinite ease-in-out; }
        @keyframes w-pulse { 0%, 100% { transform: scaleY(0.3); } 50% { transform: scaleY(1); } }

        /* –í–≤–æ–¥ */
        .input-box { background: rgba(0,0,0,0.3); border-radius: 15px; padding: 8px 12px; display: flex; gap: 10px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        input { background: none; border: none; color: white; flex: 1; outline: none; font-size: 14px; }
        
        /* –î–Ω–µ–≤–Ω–∏–∫ */
        .diary-box { width: 100%; max-width: 340px; margin-top: 25px; background: rgba(255,255,255,0.02); border-radius: 20px; padding: 15px; max-height: 150px; overflow-y: auto; }
        .diary-title { font-size: 12px; font-weight: bold; margin-bottom: 10px; opacity: 0.5; text-align: center; }
        .diary-item { font-size: 13px; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.05); color: #ccc; }

        .big-btn { width: 90px; height: 90px; border-radius: 50%; border: none; background: linear-gradient(135deg, #ff9500, #ff5e00); font-size: 40px; cursor: pointer; box-shadow: 0 5px 20px rgba(255,149,0,0.3); margin-top: 10px; }
    </style>
</head>
<body>

    <h2 style="margin-bottom: 5px;">MeowVibe AI üêæ</h2>
    
    <div class="trust-section">
        <div class="trust-label"><span>–î–æ–≤–µ—Ä–∏–µ</span><span id="trust-pct">50%</span></div>
        <div class="trust-bar"><div id="trust-fill"></div></div>
    </div>

    <div class="hooks-grid">
        <div class="hook-card" onclick="playEffect('can')"><span>ü•´</span><b>–ë–∞–Ω–∫–∞</b></div>
        <div class="hook-card" onclick="playEffect('pouch')"><span>üõçÔ∏è</span><b>–ü–∞–∫–µ—Ç</b></div>
        <div class="hook-card" onclick="buyStars('scare', 10)"><span>üö´</span><b>–ö—ã—à (‚≠êÔ∏è 10)</b></div>
        <div class="hook-card" onclick="buyStars('food', 5)"><span>üßÅ</span><b>–ü–∞—à—Ç–µ—Ç (‚≠êÔ∏è 5)</b></div>
    </div>

    <div class="main-card">
        <div id="laser"></div>
        <div class="input-box">
            <input type="text" id="msg" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è —Å–∏–Ω—Ç–µ–∑–∞...">
            <button onclick="synthesize()" style="background:var(--accent); border:none; border-radius:8px; padding:5px 10px; font-weight:bold;">üó£Ô∏è</button>
        </div>
        
        <div class="wave-box" id="wave">
            <div class="bar"></div><div class="bar" style="animation-delay:0.1s"></div><div class="bar" style="animation-delay:0.2s"></div><div class="bar" style="animation-delay:0.3s"></div>
        </div>

        <div id="status" style="font-size: 16px; min-height: 40px; color: #ffcc00;">–ì–æ—Ç–æ–≤ –∫ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</div>
        <button class="big-btn" id="btn" onclick="startScan()">üêæ</button>
    </div>

    <div class="diary-box">
        <div class="diary-title">–î–ù–ï–í–ù–ò–ö –ú–´–°–õ–ï–ô</div>
        <div id="diary-list"></div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let trust = 50;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const bad = ["–ì–¥–µ –µ–¥–∞, –∫–æ–∂–∞–Ω—ã–π? üòæ", "–ö–∞–∫ —Ü–∞—Ä–∞–ø–Ω—É! üòº", "–¢—ã–≥-–¥—ã–∫ —É—Å—Ç—Ä–æ–∏—Ç—å?", "–û–ø—è—Ç—å —Ç—ã?", "–ù–µ—Å–∏ –ø–∞—à—Ç–µ—Ç!"];
    const good = ["–õ—é–±–∏–º—ã–π –∫–æ–∂–∞–Ω—ã–π... ‚ù§Ô∏è", "–ì–ª–∞–¥—å –º–µ–Ω—è –ø–æ–ª–Ω–æ—Å—Ç—å—é! ‚ú®", "–ú–æ–∏ –º—è—É –¥–ª—è —Ç–µ–±—è.", "–¢—ã –ª—É—á—à–∏–π —á–µ–ª–æ–≤–µ–∫.", "–ú—Ä—Ä—Ä-–º—è—É!"];

    function startScan() {
        if(trust < 15) return tg.showAlert("–ö–æ—Ç –∑–ª–∏—Ç—Å—è! –ù–∞–∫–æ—Ä–º–∏ –µ–≥–æ.");
        
        animateProcess(2500, ["–°—á–∏—Ç—ã–≤–∞–Ω–∏–µ —á–∞—Å—Ç–æ—Ç...", "–î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ...", "–ü–µ—Ä–µ–≤–æ–¥..."], () => {
            const list = trust > 60 ? good : bad;
            const res = list[Math.floor(Math.random() * list.length)];
            document.getElementById('status').innerText = res;
            addToDiary(res);
            trust = Math.max(5, trust - 12);
            updateUI();
        });
    }

    function synthesize() {
        const val = document.getElementById('msg').value;
        if(!val) return;
        animateProcess(1500, ["–ö–æ–¥–∏—Ä—É—é –≤ –º—è—É..."], () => {
            const meows = Math.min(Math.ceil(val.length/4), 4);
            document.getElementById('status').innerText = "üê±: " + "–ú—è—É ".repeat(meows) + "!";
            for(let i=0; i<meows; i++) setTimeout(() => beep(600 + Math.random()*400, 'sine', 0.2), i*300);
            document.getElementById('msg').value = "";
            trust = Math.max(5, trust - 3);
            updateUI();
        });
    }

    function animateProcess(dur, steps, cb) {
        const laser = document.getElementById('laser');
        const wave = document.getElementById('wave');
        const status = document.getElementById('status');
        const btn = document.getElementById('btn');

        laser.style.display = 'block';
        laser.style.animation = `scanAnim ${dur/2000}s infinite linear`;
        wave.style.display = 'flex';
        btn.style.pointerEvents = 'none';

        let sIdx = 0;
        const intrvl = setInterval(() => {
            if(sIdx < steps.length) status.innerText = steps[sIdx++];
            tg.HapticFeedback.impactOccurred('light');
        }, dur/steps.length);

        setTimeout(() => {
            clearInterval(intrvl);
            laser.style.display = 'none';
            wave.style.display = 'none';
            btn.style.pointerEvents = 'auto';
            cb();
            tg.HapticFeedback.notificationOccurred('success');
        }, dur);
    }

    function playEffect(t) {
        tg.HapticFeedback.impactOccurred('medium');
        if(t === 'can') { beep(700, 'square', 0.05); setTimeout(()=>beep(400, 'sine', 0.2), 100); }
        else { makeNoise(0.6); }
        trust = Math.min(100, trust + 15);
        updateUI();
        tg.showAlert("–ó–≤—É–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω! –î–æ–≤–µ—Ä–∏–µ +15%");
    }

    function addToDiary(text) {
        const item = document.createElement('div');
        item.className = 'diary-item';
        item.innerText = `[${new Date().toLocaleTimeString()}] ${text}`;
        const list = document.getElementById('diary-list');
        list.prepend(item);
    }

    function updateUI() {
        document.getElementById('trust-fill').style.width = trust + "%";
        document.getElementById('trust-pct').innerText = trust + "%";
        document.getElementById('trust-fill').style.filter = trust < 30 ? "hue-rotate(-50deg)" : (trust > 70 ? "hue-rotate(70deg)" : "none");
    }

    function buyStars(type, p) {
        tg.showConfirm(`–ö—É–ø–∏—Ç—å –∑–∞ ‚≠êÔ∏è ${p}?`, (ok) => {
            if(ok && type === 'food') { trust = 100; updateUI(); tg.showAlert("–ú—Ä—Ä—Ä! –í–∫—É—Å–Ω–æ!"); }
        });
    }

    function beep(f, t, d) {
        const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
        o.type = t; o.frequency.value = f; o.connect(g); g.connect(audioCtx.destination);
        o.start(); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d); o.stop(audioCtx.currentTime + d);
    }

    function makeNoise(d) {
        const b = audioCtx.createBuffer(1, audioCtx.sampleRate * d, audioCtx.sampleRate);
        const data = b.getChannelData(0);
        for (let i = 0; i < b.length; i++) data[i] = Math.random() * 2 - 1;
        const s = audioCtx.createBufferSource(); s.buffer = b;
        const f = audioCtx.createBiquadFilter(); f.type = 'highpass'; f.frequency.value = 1500;
        s.connect(f); f.connect(audioCtx.destination); s.start();
    }
    
    updateUI();
</script>
</body>
</html>
