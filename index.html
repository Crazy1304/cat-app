<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <script src="https://telegram.org"></script>
    <style>
        :root { 
            --accent: #ff9500; 
            --gold: #ffd700;
            --glass: rgba(255, 255, 255, 0.07);
            --glass-border: rgba(255, 255, 255, 0.12);
        }

        * { -webkit-touch-callout: none; user-select: none; box-sizing: border-box; outline: none; }

        body { 
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            color: white; font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            display: flex; flex-direction: column; align-items: center; margin: 0; padding: 20px;
            min-height: 100vh; overflow-x: hidden; position: relative;
        }

        /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
        .bg-blob {
            position: fixed; width: 300px; height: 300px; 
            background: var(--accent); filter: blur(80px); opacity: 0.15;
            border-radius: 50%; z-index: -1; animation: float 15s infinite alternate;
        }
        .bg-blob.blue { background: #3390ec; left: -100px; top: -100px; }
        .bg-blob.orange { bottom: -100px; right: -100px; animation-delay: -5s; }
        @keyframes float { 0% { transform: translate(0,0); } 100% { transform: translate(50px, 100px); } }

        .glass-card {
            width: 100%; max-width: 360px; background: var(--glass);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 28px;
            padding: 20px; margin-bottom: 15px; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }

        .setup-screen { display: block; text-align: center; margin-top: 10vh; }
        .app-screen { display: none; width: 100%; max-width: 360px; }

        input, select {
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border);
            color: white; padding: 14px; border-radius: 16px; margin-bottom: 12px; font-size: 15px;
        }

        .btn-main {
            background: linear-gradient(135deg, #ff9500, #ff5e00); color: white;
            border: none; padding: 16px; border-radius: 18px; font-weight: 700;
            width: 100%; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(255,149,0,0.3);
        }
        .btn-main:active { transform: scale(0.96); }
        .btn-premium { background: linear-gradient(135deg, #ffd700, #ff9500); color: black; margin-top: 10px; }

        .mood-chart {
            width: 100%; height: 50px; display: flex; align-items: flex-end; gap: 6px; 
            margin: 10px 0; padding: 0 5px; background: rgba(255,255,255,0.03); border-radius: 10px;
        }
        .mood-bar { flex: 1; background: var(--accent); border-radius: 4px; min-height: 4px; transition: 0.8s; }

        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin: 15px 0; }
        .tool-btn { 
            background: rgba(255,255,255,0.05); border-radius: 20px; padding: 15px 5px; 
            text-align: center; border: 1px solid var(--glass-border); position: relative;
        }
        .lock { position: absolute; top: -5px; right: -5px; font-size: 12px; display: none; }

        .limit-badge { font-size: 10px; color: var(--accent); font-weight: bold; margin-bottom: 5px; display: block; }
        
        .oracle-box {
            background: rgba(255, 215, 0, 0.1); border: 1px solid var(--gold);
            border-radius: 20px; padding: 15px; margin-top: 15px; display: none;
        }

        #scan-line { 
            position: absolute; left: 0; width: 100%; height: 2px; 
            background: var(--accent); box-shadow: 0 0 20px var(--accent); 
            display: none; z-index: 10; top: 0;
        }
        @keyframes scanMove { 0% { top: 0%; } 100% { top: 100%; } }
    </style>
</head>
<body>

    <div class="bg-blob blue"></div>
    <div class="bg-blob orange"></div>

    <!-- –≠–ö–†–ê–ù –ù–ê–°–¢–†–û–ô–ö–ò -->
    <div id="setup" class="setup-screen glass-card">
        <h2 style="color:var(--accent); margin-bottom: 20px;">–ü–†–û–§–ò–õ–¨ –ö–û–¢–ê</h2>
        <input type="text" id="cat-name" placeholder="–ö–ª–∏—á–∫–∞ –ø–∏—Ç–æ–º—Ü–∞">
        <select id="cat-age">
            <option value="kitten">–ö–æ—Ç—ë–Ω–æ–∫ (–ø–∏—Å–∫–ª—è–≤—ã–π)</option>
            <option value="adult" selected>–í–∑—Ä–æ—Å–ª—ã–π (—Å—Ç–∞–Ω–¥–∞—Ä—Ç)</option>
            <option value="senior">–ú—É–¥—Ä—ã–π (–±–∞—Å–æ–≤–∏—Ç—ã–π)</option>
        </select>
        <select id="cat-temper">
            <option value="1">–õ–∞—Å–∫–æ–≤—ã–π –º—É—Ä–ª—ã–∫–∞</option>
            <option value="2">–ù–æ—á–Ω–æ–π —Ç—ã–≥–¥—ã–∫</option>
            <option value="3">–ú–∞–ª–µ–Ω—å–∫–∏–π —Ç–∏—Ä–∞–Ω</option>
        </select>
        <button class="btn-main" onclick="saveProfile()">–°–û–ó–î–ê–¢–¨ –ü–ê–°–ü–û–†–¢ üêæ</button>
    </div>

    <!-- –û–°–ù–û–í–ù–û–ô –≠–ö–†–ê–ù -->
    <div id="app" class="app-screen">
        <div class="glass-card" style="text-align: center;">
            <div id="display-name" style="font-size: 24px; font-weight: 900; color: var(--accent);">–ö–û–¢</div>
            <div class="mood-chart" id="chart"></div>
            <div style="font-size: 10px; opacity: 0.5;">–¢–†–ï–ö–ï–† –ù–ê–°–¢–†–û–ï–ù–ò–Ø (–ù–ï–î–ï–õ–Ø)</div>
        </div>

        <div class="glass-card">
            <span class="limit-badge" id="trans-limit">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 5 –ø–µ—Ä–µ–≤–æ–¥–æ–≤</span>
            <input type="text" id="user-msg" placeholder="–¢–µ–∫—Å—Ç –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞ –≤ –ú–Ø–£...">
            <button class="btn-main" onclick="translateMeow()">–û–ó–í–£–ß–ò–¢–¨</button>
        </div>

        <div class="glass-card" style="position: relative; overflow: hidden;">
            <div id="scan-line"></div>
            <div id="status" style="font-weight: bold; color: var(--accent); margin-bottom: 15px;">–ë–ò–û-–°–ï–¢–ö–ê –ì–û–¢–û–í–ê</div>
            <button onclick="deepScan()" style="background:none; border:none; font-size:60px; cursor:pointer; filter: drop-shadow(0 0 10px var(--accent));">üêæ</button>
            
            <div class="grid-3">
                <div class="tool-btn" onclick="useTool('magnet')">üçó<br><small>–ü–†–ò–ó–´–í</small><div class="lock" id="l1">üîí</div></div>
                <div class="tool-btn" onclick="useTool('stop')">üö´<br><small>–°–¢–û–ü</small><div class="lock" id="l2">üîí</div></div>
                <div class="tool-btn" onclick="useTool('purr')">üí§<br><small>–ú–£–†</small><div class="lock" id="l3">üîí</div></div>
            </div>
            <span class="limit-badge" id="tools-limit">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ: 3 —Ö—É–∫–∞</span>
        </div>

        <button class="btn-main btn-premium" id="premium-btn" onclick="buyPremium()">üîì UNLIMITED + –û–†–ê–ö–£–õ (50 ‚≠ê)</button>

        <div class="oracle-box" id="oracle">
            <div style="color: var(--gold); font-weight: bold; font-size: 12px; text-transform: uppercase;">üîÆ –û—Ä–∞–∫—É–ª –ú—è—É</div>
            <div id="oracle-text" style="font-size: 14px; margin-top: 8px; line-height: 1.4;"></div>
        </div>
    </div>

<script>
    const tg = window.Telegram?.WebApp || null;
    let audioCtx = null;
    let state = {
        name: "", age: "adult", 
        isPremium: false,
        transLeft: 5, toolsLeft: 3,
        moodHistory: [50, 50, 50, 50, 50, 50, 50]
    };

    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }

    function saveProfile() {
        state.name = document.getElementById('cat-name').value || "–°–Ω–µ–∂–æ–∫";
        state.age = document.getElementById('cat-age').value;
        localStorage.setItem('meow_v11_state', JSON.stringify(state));
        showApp();
    }

    function showApp() {
        document.getElementById('setup').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('display-name').innerText = state.name.toUpperCase();
        updateUI();
        if(tg) { tg.ready(); tg.expand(); tg.setHeaderColor('#0f0c29'); }
    }

    function updateUI() {
        document.getElementById('trans-limit').innerText = state.isPremium ? "PREMIUM ACTIVE" : `–û—Å—Ç–∞–ª–æ—Å—å –ø–µ—Ä–µ–≤–æ–¥–æ–≤: ${state.transLeft}`;
        document.getElementById('tools-limit').innerText = state.isPremium ? "PREMIUM ACTIVE" : `–û—Å—Ç–∞–ª–æ—Å—å —Ö—É–∫–æ–≤: ${state.toolsLeft}`;
        
        if(state.isPremium) {
            document.getElementById('premium-btn').style.display = 'none';
            showOracle();
        } else if(state.toolsLeft <= 0) {
            document.getElementById('l1').style.display = document.getElementById('l2').style.display = document.getElementById('l3').style.display = 'block';
        }
        renderChart();
    }

    function renderChart() {
        const chart = document.getElementById('chart');
        chart.innerHTML = "";
        state.moodHistory.forEach(v => {
            const b = document.createElement('div');
            b.className = 'mood-bar';
            b.style.height = v + "%";
            chart.appendChild(b);
        });
    }

    function synthMeow(f, d, v) {
        initAudio();
        const o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.type = 'triangle';
        o.frequency.setValueAtTime(f, audioCtx.currentTime);
        o.frequency.exponentialRampToValueAtTime(f*1.5, audioCtx.currentTime + d*0.2);
        o.frequency.linearRampToValueAtTime(f*0.8, audioCtx.currentTime + d);
        g.gain.setValueAtTime(0, audioCtx.currentTime);
        g.gain.linearRampToValueAtTime(v, audioCtx.currentTime + 0.05);
        g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + d);
    }

    function translateMeow() {
        if(!state.isPremium && state.transLeft <= 0) return buyPremium();
        const msg = document.getElementById('user-msg').value;
        if(!msg) return;
        
        if(!state.isPremium) state.transLeft--;
        localStorage.setItem('meow_v11_state', JSON.stringify(state));
        updateUI();

        let freq = state.age === 'kitten' ? 800 : (state.age === 'senior' ? 250 : 450);
        synthMeow(freq, 0.4, 0.2);
    }

    function useTool(type) {
        if(!state.isPremium && state.toolsLeft <= 0) return buyPremium();
        if(!state.isPremium) state.toolsLeft--;
        localStorage.setItem('meow_v11_state', JSON.stringify(state));
        updateUI();

        if(type === 'magnet') synthMeow(600, 0.5, 0.3);
        if(type === 'stop') synthMeow(150, 0.2, 0.2, 'sawtooth');
        if(type === 'purr') {
            tg?.HapticFeedback.impactOccurred('soft');
            synthMeow(40, 1.0, 0.1, 'sine');
        }
    }

    function deepScan() {
        const line = document.getElementById('scan-line');
        const status = document.getElementById('status');
        line.style.display = 'block';
        line.style.animation = 'scanMove 2s infinite linear';
        status.innerText = "–°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø –ü–£–õ–¨–°–ê...";

        let beats = 0;
        const heart = setInterval(() => {
            tg?.HapticFeedback.impactOccurred('medium');
            beats++; if(beats > 8) clearInterval(heart);
        }, 450);

        setTimeout(() => {
            line.style.display = 'none';
            const newMood = Math.floor(Math.random() * 60) + 40;
            state.moodHistory.shift();
            state.moodHistory.push(newMood);
            localStorage.setItem('meow_v11_state', JSON.stringify(state));
            updateUI();
            status.innerText = "–ê–ù–ê–õ–ò–ó –ó–ê–í–ï–†–®–ï–ù ‚úÖ";
        }, 4000);
    }

    function showOracle() {
        const preds = [
            "–°–µ–≥–æ–¥–Ω—è –º–∏—Å–∫–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–∞ –¥–æ –∫—Ä–∞–µ–≤!", "–û—Å—Ç–µ—Ä–µ–≥–∞–π—Å—è –ø—ã–ª–µ—Å–æ—Å–∞, –æ–Ω –∑–∞–º—ã—à–ª—è–µ—Ç –Ω–µ–ª–∞–¥–Ω–æ–µ.",
            "–í—Ä–µ–º—è –¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫—É—Å—å –Ω–∞—Å—Ç–∞–Ω–µ—Ç –≤ 18:00.", "–¢–≤–æ–π —á–µ–ª–æ–≤–µ–∫ —Å–µ–≥–æ–¥–Ω—è –æ—Å–æ–±–µ–Ω–Ω–æ –¥–æ–±—Ä.",
            "–ó–≤–µ–∑–¥—ã —Å—É–ª—è—Ç —Ç–µ–±–µ —Å–∞–º—É—é –º—è–≥–∫—É—é –∫–æ—Ä–æ–±–∫—É –≤ –º–∏—Ä–µ."
        ];
        document.getElementById('oracle').style.display = 'block';
        const day = new Date().getDate() % preds.length;
        document.getElementById('oracle-text').innerText = preds[day];
    }

    function buyPremium() {
        tg?.showConfirm("–†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –û—Ä–∞–∫—É–ª–∞ –∑–∞ 50 ‚≠ê?", (ok) => {
            if(ok) {
                state.isPremium = true;
                localStorage.setItem('meow_v11_state', JSON.stringify(state));
                updateUI();
                tg.showAlert("‚ú® –ü–†–ï–ú–ò–£–ú –ê–ö–¢–ò–í–ò–†–û–í–ê–ù!");
            }
        });
    }

    window.onload = () => {
        const saved = localStorage.getItem('meow_v11_state');
        if(saved) { state = JSON.parse(saved); showApp(); }
    };
</script>
</body>
</html>
